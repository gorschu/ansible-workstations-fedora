---
# Base system configuration - repositories and core utilities
# Note: ZFS and zrepl are handled by the dedicated zfs role

- name: Configure repositories and install packages
  become: true
  block:
    - name: Install RPM Fusion repositories
      ansible.builtin.dnf:
        name:
          - >-
            https://mirrors.rpmfusion.org/free/fedora/rpmfusion-free-release-{{
            ansible_distribution_major_version }}.noarch.rpm
          - >-
            https://mirrors.rpmfusion.org/nonfree/fedora/rpmfusion-nonfree-release-{{
            ansible_distribution_major_version }}.noarch.rpm
        state: present
        disable_gpg_check: true

    - name: Configure YAMA ptrace scope
      ansible.posix.sysctl:
        name: kernel.yama.ptrace_scope
        value: "1"
        state: present
        sysctl_file: /etc/sysctl.d/90-yama.conf
        reload: true

    - name: Install system utilities
      ansible.builtin.dnf:
        name: "{{ base_system_utils }}"
        state: present

    - name: Install CLI tools
      ansible.builtin.dnf:
        name: "{{ base_cli_utils }}"
        state: present
